= PINK
:imagesdir: images
:icons: font
:date: October 6-10, 2019
:my_name: Bernd Doser
:my_email: bernd.doser@h-its.org
:my_twitter: BerndDoser
:my_github: BerndDoser
:revealjs_slideNumber: true
:revealjs_center: false
:customcss: custom.css
:source-highlighter: highlightjs
//:title-slide-background-color: white
//:title-slide-background-image: eso1830a.tif
:title-slide-transition: zoom

Parallelized rotation and flipping INvariant +
Kohonen maps

image::HITS_RGB_eng.jpg[width=40%]

https://h-its.org[HITS gGmbH] +
https://www.adass2019.nl/[ADASS 2019]


== Self-organizing Kohonen Map

  - Low dimensional representation of the data
  - Unsupervised learning: No labeling

image::som.png[width=30%]


== Assignment 

  * Spatial transformations
    ** Rotation
    ** Flipping
  * Similarity by euclidean distance

== Adaptation 

Update assigned neuron with image +
weighted by a distribution function

image::adapt.jpg[width=70%]

== Neuron and euclidean distance dimension

image::dimensions.jpg[width=70%]


== Software Design

Generic C++17 design for static type safety

[source, c++]
----
Data<DataLayout, T> data;
SOM<SOMLayout, NeuronLayout, T> som;
Trainer<SOMLayout, NeuronLayout, T, UseGPU> trainer(som);

trainer(data); \\ Execution of training
----

  * Data- and NeuronLayout: Cartesian<N> +
    with N = 1, 2, 3
  * SOMLayout: Cartesian<N>, Hexagonal
  * T: float32 


== Python Interface

Dynamic python interface using
https://github.com/pybind/pybind11[PyBind11] +
combined with C++ inheritance

[source, python]
----
som_dim = 8
neuron_dim = int(image_dim / math.sqrt(2.0) * 2.0)

np_som = numpy.random.rand(som_dim, som_dim,
    neuron_dim, neuron_dim).astype(np.float32)
som = pink.SOM(np_som, som_layout="cartesian-2d")

trainer = pink.Trainer(som)

iter = iter(tools.DataIterator("data.bin"))
for image in iter:
    trainer(pink.Data(image))
----


== Mixed precision ==

The precision for the euclidean distance can be reduced

[cols="^,>,>"]
|===
| float | 32 bit | 4294967296
| int16 | 16 bit | 65536
| int8  | 8 bit  | 256
|===


== Benchmark: CPU vs GPU

[cols="<,^", width=100%, frame=none, grid=none, %header]
|===
|                            | Time / s
| Intel Gold 5118, 24 cores  |    35373
| NVIDIA RTX 2080, int8      |      673
|===

Radio Galaxy Zoo, hexagonal SOM 21x21, neurons 64x64


== Benchmark: Mixed Precision

[cols="<,^", width=100%, frame=none, grid=none, %header]
|===
|                            | Time / s
| NVIDIA RTX 2080, float     |     1867
| NVIDIA RTX 2080, int16     |     1062
| NVIDIA RTX 2080, int8      |      673
|===

